<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>이벤트 - TODOS</title>
    <link rel="stylesheet" href="css/style.css"/>
</head>
<body>
<div class="todoapp">
    <h1>TODOS</h1>
    <input
            id="new-todo-title"
            class="new-todo"
            placeholder="할일을 추가해주세요"
            autofocus
    />
    <main>
        <input class="toggle-all" type="checkbox"/>
        <ul id="todo-list" class="todo-list"></ul>
        <div class="count-container">
            <span class="todo-count">총 <strong>0</strong> 개</span>
            <ul class="filters">
                <li>
                    <a class="all selected" href="#">전체보기</a>
                </li>
                <li>
                    <a class="active" href="#active">해야할 일</a>
                </li>
                <li>
                    <a class="completed" href="#completed">완료한 일</a>
                </li>
            </ul>
        </div>
    </main>
</div>
</body>
</html>
<script>
	const newTodoInput = document.getElementById('new-todo-title');
	const todoList = document.getElementById('todo-list');
	const filters = document.querySelector('.filters');

	function addTodo({key, target}) {
		if (key === 'Enter') {
			todoList.insertAdjacentHTML('beforeend',
				`<li class="active">
                <div class="view">
                    <input class="toggle" type="checkbox" />
                    <label class="label">${target.value}</label>
                    <button class="destroy"></button>
                </div>
                <input class="edit" value=${target.value} />
            </li>`
			);
			document.querySelector('.todo-count > strong').textContent = todoList.childElementCount;
		}
	}

	function removeTodo({target}) {
		if (target.className === 'destroy') {
			target.parentElement.parentElement.remove();
			document.querySelector('.todo-count > strong').textContent = todoList.childElementCount;
		}
	}

	function checkCompleteTodo({target}) {
		if (target.className === 'toggle') {
			target.parentElement.parentElement.classList.toggle('completed');
			target.parentElement.parentElement.classList.toggle('active');
			target.toggleAttribute('checked')
			document.querySelector('.todo-count > strong').textContent = todoList.childElementCount;
		}
	}

	function editTodo({key, target}) {
		if (target.className === 'label') {
			target.parentElement.parentElement.classList.toggle('editing');
		} else if (key === 'Enter') {
			target.parentElement.querySelector('.label').textContent = target.value;
			target.parentElement.classList.remove('editing')
		} else if (key === 'Escape') {
			target.parentElement.classList.remove('editing')
		}
	}

	function filter({target}) {
		const completeTodos = todoList.getElementsByClassName('completed');
		const activeTodos = todoList.getElementsByClassName('active')

		Array.from(todoList.childNodes).map(todo => todo.removeAttribute('style'))
		document.querySelector('.todo-count > strong').textContent = todoList.childElementCount;
		if (target.className === 'active') {
			Array.from(completeTodos).map(todo => todo.style.display = 'none')
			document.querySelector('.todo-count > strong').textContent = activeTodos.length;
		} else if (target.className === 'completed') {
			Array.from(activeTodos).map(todo => todo.style.display = 'none')
			document.querySelector('.todo-count > strong').textContent = completeTodos.length;
		}
	}

	newTodoInput.addEventListener("keyup", addTodo);
	todoList.addEventListener('click', removeTodo);
	todoList.addEventListener('click', checkCompleteTodo);
	todoList.addEventListener('dblclick', editTodo);
	todoList.addEventListener('keyup', editTodo);
	filters.addEventListener('click', filter)

</script>
